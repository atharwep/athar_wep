<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ø«Ø± | Ø§Ù„Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="protection.js"></script>
    <script src="js/modules/prompt_builder.js"></script>
    <style>
        .page-container {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
        }

        .input-card {
            background: var(--glass-bg);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            margin-bottom: 30px;
        }

        textarea,
        input,
        select {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid var(--glass-border);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            margin-bottom: 15px;
            font-family: 'Cairo';
        }

        .btn-full {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            border: none;
            background: #9333ea;
            color: white;
            transition: 0.3s;
        }

        .result-card {
            background: white;
            color: #333;
            padding: 30px;
            border-radius: 15px;
            display: none;
            line-height: 1.8;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .question-card {
            background: #faf5ff;
            border: 1px solid #e9d5ff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .answer-sample {
            background: #fff;
            padding: 10px;
            border: 1px dashed #9333ea;
            margin-top: 10px;
            font-size: 0.9rem;
        }
    </style>
</head>

<body class="light-theme">
    <nav>
        <div class="logo-container">
            <a href="index.html" style="text-decoration:none; display:flex; align-items:center; gap:10px;">
                <img src="ØªÙ†Ø²ÙŠÙ„.jpg" alt="Logo" style="width:40px; border-radius:5px;">
                <div class="logo">Ø£Ø«Ù€Ù€Ù€Ù€Ù€Ø±</div>
            </a>
        </div>
    </nav>

    <div class="page-container">
        <header style="text-align:center; margin-bottom:40px;">
            <h1 style="font-weight:900; color:#9333ea; font-size: 2.5rem;">ğŸ“ Ø®Ø¨ÙŠØ± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</h1>
            <p style="color:var(--text-secondary);">Ø§Ø³ØªØ¹Ø¯ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ÙƒØªØ§Ø¨ÙŠØ© (Written Tests) ÙˆØ§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (Technical
                Tasks) ÙÙŠ Ø§Ù„Ù…Ù†Ø¸Ù…Ø§Øª.</p>
        </header>

        <div class="input-card">
            <div class="form-group">
                <label>Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø£Ùˆ Ø§Ù„ÙˆØµÙ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ Ù„Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©:</label>
                <textarea id="jobDesc" rows="4" placeholder="Ø§Ù„ØµÙ‚ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù…Ø¹Ù„Ù† Ø¹Ù†Ù‡Ø§..."></textarea>
            </div>
            <div class="form-group">
                <label>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙˆØ¸ÙŠÙØ©:</label>
                <select id="jobLevel">
                    <option value="Intern/Volunteer">Ù…ØªØ¯Ø±Ø¨/Ù…ØªØ·ÙˆØ¹</option>
                    <option value="Assistant/Junior">Ù…Ø³Ø§Ø¹Ø¯ / Ù…Ø¨ØªØ¯Ø¦</option>
                    <option value="Officer">Ù…Ø³Ø¤ÙˆÙ„ (Officer)</option>
                    <option value="Manager/Senior">Ù…Ø¯ÙŠØ± / Ù…ØªÙ‚Ø¯Ù…</option>
                </select>
            </div>
            <button id="getTestsBtn" class="btn-full">ØªÙˆÙ„ÙŠØ¯ Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª âš¡</button>
        </div>

        <div id="statusLog" style="text-align:center; margin-bottom:20px; font-weight:bold;"></div>

        <div id="resultArea" class="result-card">
            <div id="testContent"></div>
            <button id="exportBtn" class="btn btn-ghost" style="margin-top:20px; width:100%; border:1px solid #ddd;">ğŸ“¥
                Ø·Ø¨Ø§Ø¹Ø© Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
        </div>
    </div>

    <script>
        const BRIDGE_URL = "https://script.google.com/macros/s/AKfycby0-da3m_iVDFst4K4ha67SzbhC-BJ0bGVrLabj4Eh7Nosr0Jhw3zqsgRDSZiNgw5_1_w/exec";

        document.getElementById('getTestsBtn').onclick = async () => {
            const desc = document.getElementById('jobDesc').value;
            const level = document.getElementById('jobLevel').value;

            if (!desc) return alert("ÙŠØ±Ø¬Ù‰ Ù„ØµÙ‚ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙØ©.");

            const btn = document.getElementById('getTestsBtn');
            const status = document.getElementById('statusLog');
            btn.disabled = true;
            status.innerText = "â³ Ø¬Ø§Ø±ÙŠ ØªØµÙ…ÙŠÙ… Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø© Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù†Ø¸Ù…Ø§Øª Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©...";

            const prompt = PromptBuilder.buildUnifiedPrompt('Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª', desc, {
                experienceLevel: level,
                itemCount: 10 // For tests, maybe 10 is enough, but PromptBuilder defaults to 30 if itemCount is passed. 
                // Wait, I should check PromptBuilder.
            });

            try {
                const res = await fetch(BRIDGE_URL + "?action=ai", {
                    method: "POST",
                    headers: { "Content-Type": "text/plain;charset=utf-8" },
                    body: JSON.stringify({
                        model: "llama-3.3-70b-versatile",
                        messages: [{ role: "user", content: prompt }],
                        temperature: 0.7
                    })
                });

                const dataText = await res.text();
                const json = JSON.parse(dataText.match(/\{[\s\S]*\}/)[0]);
                const questions = json.items || json.sample_questions || [];

                let html = `
                    <div style="text-align:center; padding:15px; background:#f5f3ff; border-radius:10px; margin-bottom:20px;">
                        <h3 style="color:#9333ea; margin:0;">Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: ${json.test_type}</h3>
                        <p style="margin:5px 0;">${json.assessment_logic}</p>
                    </div>

                    <h3 style="color:var(--primary); border-bottom:1px solid #ddd; padding-bottom:5px;">ğŸ“ Ø£Ø³Ø¦Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± ØªØ¯Ø±ÙŠØ¨ÙŠØ©</h3>
                    ${questions.map(q => `
                        <div class="question-card">
                            <strong>Ø§Ù„Ø³Ø¤Ø§Ù„: ${q.q}</strong>
                            <div style="font-size:0.8rem; color:#6b7280; font-style:italic; margin:5px 0;">Ø§Ù„Ù‡Ø¯Ù: ${q.tag || q.logic || 'ØªÙ‚ÙŠÙŠÙ… ØªÙ‚Ù†ÙŠ'}</div>
                            <div class="answer-sample"><strong>âœ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ØªØªØ¶Ù…Ù†:</strong> ${q.a || q.answer_outline}</div>
                        </div>
                    `).join('')}

                    <h3 style="color:#9333ea; margin-top:25px;">ğŸ’» Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„ØªÙ‚Ù†ÙŠØ© (Technical Task)</h3>
                    <div style="padding:15px; border:1px solid #ddd; border-radius:10px; background:#fafafa;">
                        ${json.technical_task}
                    </div>

                    <div style="margin-top:20px;">
                        <h3 style="color:#e11d48;">âš ï¸ Ø£Ø®Ø·Ø§Ø¡ Ø´Ø§Ø¦Ø¹Ø© ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</h3>
                        <ul>${json.common_mistakes.map(m => `<li>${m}</li>`).join('')}</ul>
                    </div>

                    <div style="background:#fff7ed; padding:15px; border-radius:10px; margin-top:20px;">
                        <strong>â±ï¸ Ù†ØµÙŠØ­Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚Øª:</strong> ${json.time_management_tips}
                    </div>
                `;

                document.getElementById('testContent').innerHTML = html;
                document.getElementById('resultArea').style.display = 'block';
                status.innerText = "âœ… Ø§ÙƒØªÙ…Ù„ ØªØµÙ…ÙŠÙ… Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±!";
            } catch (e) {
                console.error(e);
                status.innerText = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£.";
            } finally {
                btn.disabled = false;
            }
        };
        document.getElementById('exportBtn').onclick = () => {
            ProtectionManager.verify(() => window.print());
        };
    </script>
</body>

</html>