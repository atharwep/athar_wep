<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ø«Ø± | Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="js/modules/auth_guard.js"></script>
    <!-- Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¯ÙŠÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
    <script src="js/modules/policy_service.js"></script>
    <script src="protection.js"></script>
    <style>
        :root {
            --org-primary: #0f172a;
            --org-accent: #3b82f6;
        }

        body {
            background-color: #f8fafc;
        }

        .org-header {
            background: var(--org-primary);
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
        }

        .page-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .input-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            border: 1px solid #e2e8f0;
        }

        .policy-result {
            display: none;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .policy-header {
            background: #eff6ff;
            padding: 20px;
            border-bottom: 2px solid var(--org-accent);
        }

        .grid-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
        }

        .card-box {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .do-box {
            background: #f0fdf4;
            border-right: 4px solid #22c55e;
        }

        .dont-box {
            background: #fef2f2;
            border-right: 4px solid #ef4444;
        }

        .risk-box {
            background: #fff7ed;
            border-right: 4px solid #f97316;
        }

        textarea,
        input,
        select {
            width: 100%;
            padding: 12px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-family: 'Cairo';
            margin-bottom: 15px;
        }

        .btn-org {
            background: var(--org-primary);
            color: white;
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        .btn-org:hover {
            background: var(--org-accent);
        }
    </style>
</head>

<body>
    <div class="org-header">
        <div class="page-container" style="display:flex; justify-content:space-between; align-items:center;">
            <div style="display:flex; align-items:center; gap:15px;">
                <div style="font-size:2rem;">âš–ï¸</div>
                <div>
                    <h1 style="margin:0; font-size:1.5rem;">Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠØ©</h1>
                    <span style="font-size:0.9rem; opacity:0.8;">Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ ÙˆØ§Ù„Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ø°ÙƒÙŠØ©</span>
                </div>
            </div>
            <a href="index.html"
                style="color:white; text-decoration:none; border:1px solid rgba(255,255,255,0.3); padding:8px 15px; border-radius:5px;">Ø¹ÙˆØ¯Ø©
                Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        </div>
    </div>

    <div class="page-container">

        <div class="input-card">
            <h3 style="margin-top:0; color:var(--org-primary);">ğŸ“„ ØªØ­Ù„ÙŠÙ„ Ø³ÙŠØ§Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
            <p style="color:#64748b; margin-bottom:20px;">Ù‚Ù… Ø¨Ù„ØµÙ‚ Ù†Øµ Ø§Ù„Ø³ÙŠØ§Ø³Ø© Ø£Ùˆ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ (PDF/Word Ù‚Ø±ÙŠØ¨Ø§Ù‹) ÙˆØ³ÙŠÙ‚ÙˆÙ… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯
                Ø¨ØªØ­ÙˆÙŠÙ„Ù‡ Ù„Ø¯Ù„ÙŠÙ„ Ø¹Ù…Ù„ÙŠ.</p>

            <div style="display:grid; grid-template-columns: 2fr 1fr; gap:20px;">
                <div>
                    <label>Ù†Øµ Ø§Ù„Ø³ÙŠØ§Ø³Ø© / Ø§Ù„ØªØ¹Ù…ÙŠÙ… Ø§Ù„Ø§Ø¯Ø§Ø±ÙŠ:</label>
                    <textarea id="policyText" rows="6"
                        placeholder="Ù…Ø«Ø§Ù„: Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§ØªØŒ Ù…Ø¯ÙˆÙ†Ø© Ø§Ù„Ø³Ù„ÙˆÙƒØŒ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø£Ù…Ù† ÙˆØ§Ù„Ø³Ù„Ø§Ù…Ø©..."></textarea>
                </div>
                <div>
                    <label>Ø§Ù„Ø¯ÙˆØ± Ø§Ù„ÙˆØ¸ÙŠÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                    <input type="text" id="targetRole" placeholder="Ù…Ø«Ø§Ù„: Ù…ÙˆØ¸Ù Ù…ÙŠØ¯Ø§Ù†ÙŠØŒ Ù…Ø¯ÙŠØ± Ù…Ø§Ù„ÙŠ...">

                    <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø³ÙŠØ§Ø³Ø©:</label>
                    <input type="text" id="policyTitle" placeholder="Ù…Ø«Ø§Ù„: Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø³ÙØ±">
                </div>
            </div>

            <button id="analyzeBtn" class="btn-org">ØªØ­Ù„ÙŠÙ„ ÙˆØ§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ âš¡</button>
            <div id="statusLog" style="margin-top:10px; text-align:center; font-weight:bold;"></div>
        </div>

        <div id="resultArea" class="policy-result">
            <div class="policy-header">
                <h2 id="resTitle" style="margin:0; color:var(--org-primary);">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„</h2>
                <p id="resSummary" style="margin:10px 0 0; color:#475569;"></p>
            </div>

            <div class="grid-layout">
                <div>
                    <h4 style="color:#166534;">âœ… Ù…Ø§ ÙŠØ¬Ø¨ ÙØ¹Ù„Ù‡ (Do's)</h4>
                    <div id="dosContainer"></div>
                </div>
                <div>
                    <h4 style="color:#991b1b;">â›” Ù…Ø§ ÙŠØ¬Ø¨ ØªØ¬Ù†Ø¨Ù‡ (Don'ts)</h4>
                    <div id="dontsContainer"></div>
                </div>
            </div>

            <div style="padding:0 20px 20px;">
                <h4 style="color:#9a3412;">âš ï¸ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©</h4>
                <div id="risksContainer"></div>

                <h4 style="color:var(--org-primary); margin-top:20px;">ğŸ“ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù„Ù„ØªÙ†ÙÙŠØ° (Checklist)</h4>
                <div id="checklistContainer"
                    style="background:#f8fafc; padding:15px; border-radius:10px; border:1px dashed #cbd5e1;"></div>

                <div id="roleAdvice"
                    style="margin-top:20px; padding:15px; background:#eff6ff; border-radius:8px; border-left:4px solid var(--org-accent);">
                </div>
            </div>

            <div style="padding:20px; border-top:1px solid #e2e8f0; text-align:center;">
                <button onclick="window.print()" class="btn btn-ghost" style="color:var(--org-primary);">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©
                    Ø§Ù„Ø¯Ù„ÙŠÙ„ ÙˆØªØ¹Ù…ÙŠÙ…Ù‡</button>
            </div>
        </div>

    </div>

    <script>
        const service = new PolicyAssistantService();

        document.getElementById('analyzeBtn').onclick = async () => {
            const text = document.getElementById('policyText').value;
            const role = document.getElementById('targetRole').value;
            const title = document.getElementById('policyTitle').value || "Ø³ÙŠØ§Ø³Ø© ØºÙŠØ± Ù…Ø¹Ù†ÙˆÙ†Ø©";

            if (!text) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ø§Ù„Ø³ÙŠØ§Ø³Ø©");

            document.getElementById('analyzeBtn').disabled = true;
            document.getElementById('statusLog').innerText = "â³ Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³ÙŠØ§Ø³Ø© ÙˆØ§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ©...";
            document.getElementById('analyzeBtn').style.opacity = "0.7";

            try {
                const data = await service.analyzePolicy(text, role);

                // Render Results
                document.getElementById('resTitle').innerText = title;
                document.getElementById('resSummary').innerText = data.summary;

                document.getElementById('dosContainer').innerHTML = (data.dos || []).map(i => `<div class="card-box do-box">âœ”ï¸ ${i}</div>`).join('');
                document.getElementById('dontsContainer').innerHTML = (data.donts || []).map(i => `<div class="card-box dont-box">âŒ ${i}</div>`).join('');
                document.getElementById('risksContainer').innerHTML = (data.risks || []).map(i => `<div class="card-box risk-box">âš ï¸ ${i}</div>`).join('');

                document.getElementById('checklistContainer').innerHTML = (data.checklist || []).map(item => `
                    <div style="display:flex; gap:10px; align-items:center; margin-bottom:8px;">
                        <input type="checkbox" ${item.critical ? 'checked disabled' : ''}>
                        <span style="${item.critical ? 'font-weight:bold; color:#b91c1c;' : ''}">${item.item} ${item.critical ? '(Ø¥Ù„Ø²Ø§Ù…ÙŠ)' : ''}</span>
                    </div>
                `).join('');

                if (data.role_specific_advice) {
                    document.getElementById('roleAdvice').innerHTML = `<strong>ğŸ’¡ Ù†ØµÙŠØ­Ø© Ø®Ø§ØµØ© Ù„Ù„${role || 'Ù…ÙˆØ¸Ù'}:</strong> ${data.role_specific_advice}`;
                }

                document.getElementById('resultArea').style.display = 'block';
                document.getElementById('statusLog').innerText = "âœ… ØªÙ… Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­";

                // Save locally
                service.savePolicy({ title, ...data });

            } catch (e) {
                document.getElementById('statusLog').innerText = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: " + e.message;
            } finally {
                document.getElementById('analyzeBtn').disabled = false;
                document.getElementById('analyzeBtn').style.opacity = "1";
            }
        };
    </script>
</body>

</html>