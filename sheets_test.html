<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ Google Sheets - Ù…Ù†ØµØ© Ø£Ø«Ø±</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            min-height: 100vh;
            padding: 40px 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 32px;
            padding: 40px;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #059669;
            text-align: center;
            margin-bottom: 15px;
            font-size: 2.2rem;
        }

        .subtitle {
            text-align: center;
            color: #6b7280;
            margin-bottom: 35px;
            font-size: 1.1rem;
        }

        .section {
            background: #f9fafb;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid #e5e7eb;
        }

        .section h2 {
            color: #1f2937;
            margin-bottom: 20px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-badge {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 0.95rem;
            margin-bottom: 20px;
        }

        .status-badge.success {
            background: #d1fae5;
            color: #065f46;
        }

        .status-badge.error {
            background: #fee2e2;
            color: #991b1b;
        }

        .status-badge.pending {
            background: #fef3c7;
            color: #92400e;
        }

        .info-box {
            background: #eff6ff;
            border: 2px solid #bfdbfe;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .info-box strong {
            color: #1e40af;
            display: block;
            margin-bottom: 8px;
        }

        .info-box code {
            background: #dbeafe;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #1e3a8a;
        }

        input[type="text"] {
            width: 100%;
            padding: 14px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1rem;
            font-family: 'Cairo', sans-serif;
            margin-bottom: 15px;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #059669;
        }

        button {
            background: #059669;
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            font-size: 1.05rem;
            transition: 0.3s;
            margin: 5px;
            font-family: 'Cairo', sans-serif;
        }

        button:hover {
            background: #047857;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(5, 150, 105, 0.3);
        }

        button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .result {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
        }

        .result.success {
            border-color: #10b981;
            background: #d1fae5;
            color: #065f46;
        }

        .result.error {
            border-color: #ef4444;
            background: #fee2e2;
            color: #991b1b;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .current-url {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            word-break: break-all;
            margin-bottom: 15px;
        }

        .step-list {
            list-style: none;
            counter-reset: step;
        }

        .step-list li {
            counter-increment: step;
            padding: 12px 0;
            padding-right: 35px;
            position: relative;
            color: #374151;
            line-height: 1.7;
        }

        .step-list li::before {
            content: counter(step);
            position: absolute;
            right: 0;
            top: 10px;
            background: #059669;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.85rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 25px;
            }

            h1 {
                font-size: 1.6rem;
            }

            .test-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ“Š Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ Google Sheets</h1>
        <p class="subtitle">ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ù…ÙˆÙ‚Ø¹Ùƒ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Google Sheets</p>

        <!-- Current URL -->
        <div class="section">
            <h2>ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ù€ Web App Ø§Ù„Ø­Ø§Ù„ÙŠ</h2>
            <div class="current-url" id="currentUrl">
                https://script.google.com/macros/s/AKfycbzCic7XWHobosbwc4PR7_zoS1aZqO6u2UO2-C5Sjm1Nrk7S_iKiCekYa-2Mz84tz-RC/exec
            </div>
            <div class="info-box">
                <strong>ğŸ’¡ Ù…Ù„Ø§Ø­Ø¸Ø©:</strong>
                Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø­Ø§Ù„ÙŠØ§Ù‹ ÙÙŠ <code>protection.js</code>. Ø¥Ø°Ø§ ÙƒÙ†Øª ØªØ±ÙŠØ¯ ØªØºÙŠÙŠØ±Ù‡ØŒ Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ø³Ø·Ø± 161 ÙÙŠ
                Ø§Ù„Ù…Ù„Ù.
            </div>
        </div>

        <!-- Test Connection -->
        <div class="section">
            <h2>âœ… Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</h2>
            <div id="connectionStatus" class="status-badge pending">â³ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø¹Ø¯</div>
            <button onclick="testConnection()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø¢Ù†</button>
            <div id="connectionResult"></div>
        </div>

        <!-- Test Visitor Count -->
        <div class="section">
            <h2>ğŸ“Š Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø²ÙˆØ§Ø±</h2>
            <button onclick="testVisitor()">ØªØ³Ø¬ÙŠÙ„ Ø²ÙŠØ§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
            <div id="visitorResult"></div>
        </div>

        <!-- Test Code Verification -->
        <div class="section">
            <h2>ğŸ’ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</h2>
            <div class="info-box">
                <strong>ğŸ“Œ ØªØ°ÙƒÙŠØ±:</strong>
                Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ØµØ­ÙŠØ­ = Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ© + 2025<br>
                Ù…Ø«Ø§Ù„: Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø¹Ø±Ù 1000ØŒ ÙØ§Ù„ÙƒÙˆØ¯ Ù‡Ùˆ 3025
            </div>
            <input type="text" id="testId" placeholder="Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (Ù…Ø«Ø§Ù„: 1000)" value="1000">
            <input type="text" id="testCode" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ (Ù…Ø«Ø§Ù„: 3025)" value="3025">
            <button onclick="testCodeVerification()">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯</button>
            <div id="codeResult"></div>
        </div>

        <!-- Test Data Retrieval -->
        <div class="section">
            <h2>ğŸ“š Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
            <div class="test-grid">
                <button onclick="testGetJobs()">Ø¬Ù„Ø¨ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</button>
                <button onclick="testGetLibrary()">Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙƒØªØ¨Ø©</button>
            </div>
            <div id="dataResult"></div>
        </div>

        <!-- Custom URL Test -->
        <div class="section">
            <h2>ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø± Ø±Ø§Ø¨Ø· Ù…Ø®ØµØµ</h2>
            <input type="text" id="customUrl" placeholder="Ø¶Ø¹ Ø±Ø§Ø¨Ø· Web App Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù‡Ù†Ø§">
            <button onclick="testCustomUrl()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø®ØµØµ</button>
            <div id="customResult"></div>
        </div>

        <!-- Instructions -->
        <div class="section">
            <h2>ğŸ“– ÙƒÙŠÙÙŠØ© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ø§Ø¨Ø· Web App Ø¬Ø¯ÙŠØ¯</h2>
            <ol class="step-list">
                <li>Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ <a href="https://script.google.com/" target="_blank" style="color: #059669;">Google Apps
                        Script</a></li>
                <li>Ø§ÙØªØ­ Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø£Ùˆ Ø£Ù†Ø´Ø¦ Ù…Ø´Ø±ÙˆØ¹Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹</li>
                <li>Ø§Ù„ØµÙ‚ ÙƒÙˆØ¯ <code>bridge_script.js</code> ÙÙŠ Ø§Ù„Ù…Ø­Ø±Ø±</li>
                <li>Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ <strong>Deploy</strong> > <strong>New deployment</strong></li>
                <li>Ø§Ø®ØªØ± <strong>Web app</strong> ÙˆØ¹ÙŠÙ‘Ù† "Who has access" Ø¥Ù„Ù‰ <strong>Anyone</strong></li>
                <li>Ø§Ù†Ø³Ø® Ø±Ø§Ø¨Ø· <strong>Web app URL</strong></li>
                <li>Ø§Ù„ØµÙ‚Ù‡ ÙÙŠ Ø§Ù„Ø­Ù‚Ù„ Ø£Ø¹Ù„Ø§Ù‡ ÙˆØ§Ø®ØªØ¨Ø±Ù‡</li>
                <li>Ø¥Ø°Ø§ Ù†Ø¬Ø­ØŒ Ø¹Ø¯Ù‘Ù„ <code>protection.js</code> (Ø§Ù„Ø³Ø·Ø± 161)</li>
            </ol>
        </div>
    </div>

    <script>
        const CURRENT_BRIDGE_URL = "https://script.google.com/macros/s/AKfycbzCic7XWHobosbwc4PR7_zoS1aZqO6u2UO2-C5Sjm1Nrk7S_iKiCekYa-2Mz84tz-RC/exec";

        // Test Connection
        async function testConnection() {
            const statusDiv = document.getElementById('connectionStatus');
            const resultDiv = document.getElementById('connectionResult');

            statusDiv.className = 'status-badge pending';
            statusDiv.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...';
            resultDiv.innerHTML = '';

            try {
                const response = await fetch(`${CURRENT_BRIDGE_URL}?action=test`);
                const data = await response.json();

                if (data.status === 'success') {
                    statusDiv.className = 'status-badge success';
                    statusDiv.textContent = 'âœ… Ù…ØªØµÙ„ Ø¨Ù†Ø¬Ø§Ø­!';
                    resultDiv.innerHTML = `<div class="result success">${JSON.stringify(data, null, 2)}</div>`;
                } else {
                    throw new Error(data.message || 'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„');
                }
            } catch (error) {
                statusDiv.className = 'status-badge error';
                statusDiv.textContent = 'âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„';
                resultDiv.innerHTML = `<div class="result error">Ø®Ø·Ø£: ${error.message}\n\nØªØ£ÙƒØ¯ Ù…Ù†:\n1. Ø±Ø§Ø¨Ø· Web App ØµØ­ÙŠØ­\n2. ØªÙ… Ù†Ø´Ø± Web App Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­\n3. "Who has access" = Anyone</div>`;
            }
        }

        // Test Visitor Count
        async function testVisitor() {
            const resultDiv = document.getElementById('visitorResult');
            resultDiv.innerHTML = '<div class="result">â³ Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø²ÙŠØ§Ø±Ø©...</div>';

            try {
                const response = await fetch(`${CURRENT_BRIDGE_URL}?action=visitor`);
                const data = await response.json();

                if (data.status === 'success') {
                    resultDiv.innerHTML = `<div class="result success">âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø²ÙŠØ§Ø±Ø©!\n\nØ¹Ø¯Ø¯ Ø§Ù„Ø²ÙˆØ§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ: ${data.count}\n\nØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø©:\n${JSON.stringify(data, null, 2)}</div>`;
                } else {
                    throw new Error(data.message || 'ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø²ÙŠØ§Ø±Ø©');
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">âŒ Ø®Ø·Ø£: ${error.message}</div>`;
            }
        }

        // Test Code Verification
        async function testCodeVerification() {
            const id = document.getElementById('testId').value;
            const code = document.getElementById('testCode').value;
            const resultDiv = document.getElementById('codeResult');

            if (!id || !code) {
                resultDiv.innerHTML = '<div class="result error">âŒ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„</div>';
                return;
            }

            resultDiv.innerHTML = '<div class="result">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯...</div>';

            try {
                const response = await fetch(`${CURRENT_BRIDGE_URL}?action=verifyCode&code=${encodeURIComponent(code)}&id=${encodeURIComponent(id)}&page=test_page`);
                const data = await response.json();

                if (data.status === 'success') {
                    resultDiv.innerHTML = `<div class="result success">âœ… ${data.message}\n\nØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø©:\n${JSON.stringify(data, null, 2)}</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="result error">âŒ ${data.message}\n\nØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø©:\n${JSON.stringify(data, null, 2)}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">âŒ Ø®Ø·Ø£: ${error.message}</div>`;
            }
        }

        // Test Get Jobs
        async function testGetJobs() {
            const resultDiv = document.getElementById('dataResult');
            resultDiv.innerHTML = '<div class="result">â³ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù...</div>';

            try {
                const response = await fetch(`${CURRENT_BRIDGE_URL}?type=jobs`);
                const data = await response.json();

                if (Array.isArray(data)) {
                    resultDiv.innerHTML = `<div class="result success">âœ… ØªÙ… Ø¬Ù„Ø¨ ${data.length} ÙˆØ¸ÙŠÙØ©\n\nØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:\n${JSON.stringify(data, null, 2)}</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="result success">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:\n${JSON.stringify(data, null, 2)}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">âŒ Ø®Ø·Ø£: ${error.message}</div>`;
            }
        }

        // Test Get Library
        async function testGetLibrary() {
            const resultDiv = document.getElementById('dataResult');
            resultDiv.innerHTML = '<div class="result">â³ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙƒØªØ¨Ø©...</div>';

            try {
                const response = await fetch(`${CURRENT_BRIDGE_URL}?type=library`);
                const data = await response.json();

                if (Array.isArray(data)) {
                    resultDiv.innerHTML = `<div class="result success">âœ… ØªÙ… Ø¬Ù„Ø¨ ${data.length} Ù…ÙˆØ±Ø¯\n\nØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:\n${JSON.stringify(data, null, 2)}</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="result success">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:\n${JSON.stringify(data, null, 2)}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">âŒ Ø®Ø·Ø£: ${error.message}</div>`;
            }
        }

        // Test Custom URL
        async function testCustomUrl() {
            const customUrl = document.getElementById('customUrl').value;
            const resultDiv = document.getElementById('customResult');

            if (!customUrl) {
                resultDiv.innerHTML = '<div class="result error">âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Web App</div>';
                return;
            }

            resultDiv.innerHTML = '<div class="result">â³ Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø±Ø§Ø¨Ø·...</div>';

            try {
                const response = await fetch(`${customUrl}?action=test`);
                const data = await response.json();

                if (data.status === 'success') {
                    resultDiv.innerHTML = `<div class="result success">âœ… Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­!\n\nÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ù†Ø³Ø® Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ ÙÙŠ protection.js:\n\nconst BRIDGE_URL = "${customUrl}";\n\nØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø©:\n${JSON.stringify(data, null, 2)}</div>`;
                } else {
                    throw new Error(data.message || 'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„');
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">âŒ Ø®Ø·Ø£: ${error.message}\n\nØªØ£ÙƒØ¯ Ù…Ù†:\n1. Ø§Ù„Ø±Ø§Ø¨Ø· ØµØ­ÙŠØ­\n2. ØªÙ… Ù†Ø´Ø± Web App\n3. "Who has access" = Anyone</div>`;
            }
        }

        // Auto-test on load
        window.addEventListener('load', () => {
            setTimeout(testConnection, 1000);
        });
    </script>
</body>

</html>